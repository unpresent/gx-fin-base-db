-- -----------------------------------------------------------------------------
-- Table: Base.Instruments
-- -----------------------------------------------------------------------------
-- DROP TABLE "Base"."Instruments";

CREATE TABLE IF NOT EXISTS "Base"."Instruments"
(
    "Id"                    int                                             NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    "Type_Id"               smallint                                        NOT NULL,
    "InternalShortName"     varchar(150)    COLLATE pg_catalog."default"    NOT NULL,
    "InternalFullName"      varchar(500)    COLLATE pg_catalog."default"        NULL,
    CONSTRAINT "Instruments_pkey" PRIMARY KEY ("Id"),
    CONSTRAINT "Instruments_fkey_Type" FOREIGN KEY ("Type_Id") REFERENCES "Base"."Instruments_Types" ("Id")
) TABLESPACE pg_default;

ALTER TABLE "Base"."Instruments" OWNER to gxfin;

-- -----------------------------------------------------------------------------
-- Table: Base.Instruments:Codes
-- -----------------------------------------------------------------------------
-- DROP TABLE "Base"."Instruments:Codes";

CREATE TABLE IF NOT EXISTS "Base"."Instruments:Codes"
(
    "Instrument_Id"         int                                             NOT NULL,
    "Provider_Id"           smallint                                        NOT NULL,
    "Index"                 smallint                                        NOT NULL,
    "Code"                  varchar(50)     COLLATE pg_catalog."default"    NOT NULL,
    "Name"                  varchar(250)    COLLATE pg_catalog."default"        NULL,
    "DateFrom"              date                                            NOT NULL,
    "DateTo"                date                                                NULL,
    CONSTRAINT "Instruments:Codes_pkey" PRIMARY KEY ("Instrument_Id", "Provider_Id", "Index"),
    CONSTRAINT "Instruments:Codes_fkey_Instrument" FOREIGN KEY ("Instrument_Id") REFERENCES "Base"."Instruments" ("Id"),
    CONSTRAINT "Instruments:Codes_fkey_Provider" FOREIGN KEY ("Provider_Id") REFERENCES "Base"."Providers" ("Id")
) TABLESPACE pg_default;

ALTER TABLE "Base"."Instruments:Codes" OWNER to gxfin;


-- -----------------------------------------------------------------------------
-- Table: Base.Instruments:Guids
-- -----------------------------------------------------------------------------
-- DROP TABLE "Base"."Instruments:Guids";

CREATE TABLE IF NOT EXISTS "Base"."Instruments:Guids"
(
    "Instrument_Id"         int                                             NOT NULL,
    "Index"                 smallint                                        NOT NULL,
    "Guid"                  uuid                                            NOT NULL,
    CONSTRAINT "Instruments:Guids_pkey" PRIMARY KEY ("Instrument_Id", "Index"),
    CONSTRAINT "Instruments:Guids_fkey_Instrument" FOREIGN KEY ("Instrument_Id") REFERENCES "Base"."Instruments" ("Id")
) TABLESPACE pg_default;

ALTER TABLE "Base"."Instruments:Guids" OWNER to gxfin;

-- -----------------------------------------------------------------------------
-- Table: Base.Instruments=Currencies
-- -----------------------------------------------------------------------------
-- DROP TABLE "Base"."Instruments=Currencies";

CREATE TABLE IF NOT EXISTS "Base"."Instruments=Currencies"
(
    "Id"                    int                                             NOT NULL,
    "CodeAlpha2"            char(2)         COLLATE pg_catalog."default"        NULL,
    "CodeAlpha3"            char(3)         COLLATE pg_catalog."default"    NOT NULL,
    "CodeDec"               smallint                                        NOT NULL,
    "Sign"                  varchar(10)     COLLATE pg_catalog."default"    NOT NULL,
    "PartsName"             varchar(100)    COLLATE pg_catalog."default"    NOT NULL,
    "PartsInOne"            int                                             NOT NULL,
    CONSTRAINT "Instruments=Currencies_pkey" PRIMARY KEY ("Id"),
    CONSTRAINT "Instruments=Currencies_fkey_Id" FOREIGN KEY ("Id") REFERENCES "Base"."Instruments" ("Id")
) TABLESPACE pg_default;

ALTER TABLE "Base"."Instruments=Currencies" OWNER to gxfin;

-- -----------------------------------------------------------------------------
-- Table: Base.Instruments=Securities
-- -----------------------------------------------------------------------------
-- DROP TABLE "Base"."Instruments=Securities";

CREATE TABLE IF NOT EXISTS "Base"."Instruments=Securities"
(
    "Id"                    int                                             NOT NULL,
    "CodeISIN"              varchar(20)     COLLATE pg_catalog."default"        NULL,
    CONSTRAINT "Instruments=Securities_pkey" PRIMARY KEY ("Id"),
    CONSTRAINT "Instruments=Securities_fkey_Id" FOREIGN KEY ("Id") REFERENCES "Base"."Instruments" ("Id")
) TABLESPACE pg_default;

ALTER TABLE "Base"."Instruments=Securities" OWNER to gxfin;

-- -----------------------------------------------------------------------------
-- Table: Base.Instruments=Derivatives
-- -----------------------------------------------------------------------------
-- DROP TABLE "Base"."Instruments=Derivatives";

CREATE TABLE IF NOT EXISTS "Base"."Instruments=Derivatives"
(
    "Id"                    int                                             NOT NULL,
    "BaseInstrument_Id"     int                                                 NULL,
    "ExpireDate"            date                                                NULL,
    CONSTRAINT "Instruments=Derivatives_pkey" PRIMARY KEY ("Id"),
    CONSTRAINT "Instruments=Derivatives_fkey_Id" FOREIGN KEY ("Id") REFERENCES "Base"."Instruments" ("Id"),
    CONSTRAINT "Instruments=Derivatives_fkey_BaseInstrument_Id" FOREIGN KEY ("BaseInstrument_Id") REFERENCES "Base"."Instruments" ("Id")
) TABLESPACE pg_default;

ALTER TABLE "Base"."Instruments=Derivatives" OWNER to gxfin;

INSERT INTO "Base"."Instruments" ("Id", "Type_Id", "InternalShortName", "InternalFullName")
VALUES
    (1,     1,  'Рубль',        'Российский рубль'),
    (2,     1,  'Доллар США',   'Доллар США'),
    (3,     1,  'Евро',         'Евро')
ON CONFLICT ("Id") DO UPDATE SET
    "Type_Id" = EXCLUDED."Type_Id",
    "InternalShortName" = EXCLUDED."InternalShortName",
    "InternalFullName" = EXCLUDED."InternalFullName";

INSERT INTO "Base"."Instruments=Currencies" ("Id", "CodeAlpha2", "CodeAlpha3", "CodeDec", "Sign", "PartsName", "PartsInOne")
VALUES
    (1,     'RU',   'RUB',  643,    '₽',    'Копейка',  100),
    (2,     'US',   'USD',  840,    '$',    'Цент',     100),
    (3,     'EU',   'EUR',  978,    '€',    'Евроцент', 100);
